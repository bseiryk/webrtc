(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{122:function(e,n){function a(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=122},127:function(e,n,a){},128:function(e,n,a){},130:function(e,n,a){"use strict";a.r(n);var t=a(0),r=a.n(t),o=a(43),i=a.n(o),c=a(2),s=a.n(c),l=a(7),u=a(44),d=a(45),m=a(51),S=a(50),h=a(46),p=a.n(h),f=a(4),v=a.n(f),C=a(47),g=a.n(C),E=a(48),k=a.n(E),M=a(5),b=a(6),w=a(132),N=a(49),O=(a(127),function(e){var n=e.isMuteAudio,a=e.isMuteVideo,t=e.isSharingScreen,o=e.isJoined,i=e.partisipantsRef,c=e.shareScreenRef,s=e.onDropCall,l=e.onMuteAudio,u=e.onMuteVideo,d=e.onShareScreen;return r.a.createElement("div",Object(N.a)({className:"call-screen"},"className",v()("call-screen",{"show-call-window":o})),r.a.createElement("div",{className:"main"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"btn red",onClick:s},r.a.createElement(M.a,{icon:b.c})),r.a.createElement("div",{className:v()("btn",{red:n}),onClick:l},r.a.createElement(M.a,{icon:b.b})),r.a.createElement("div",{className:v()("btn",{red:a}),onClick:u},r.a.createElement(M.a,{icon:b.e})),r.a.createElement("div",{className:v()("btn",{disabled:t}),onClick:d},r.a.createElement(M.a,{icon:b.a}))),r.a.createElement("div",{ref:c,className:"main-stream"})),r.a.createElement("div",{className:"partisipants-container",ref:i}))}),D={userConstraints:{video:!0,audio:{echoCancellation:!0,noiseSuppression:!0}},screenConstraints:{video:{cursor:"always",displaySurface:"monitor"},audio:!1},socketUrl:Object({NODE_ENV:"production",PUBLIC_URL:"/resources",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).URL},j=function(e,n,a){var t=document.createElement("div");t.classList.add("partisipant"),t.id=n;var r=document.createElement("video");r.addEventListener("loadedmetadata",(function(){r.play()})),r.srcObject=e,r.muted=a;var o=document.createElement("span");o.classList.add("fa","fa-microphone-slash");var i=document.createElement("span");i.classList.add("fa","fa-video-slash");var c=document.createElement("div");return c.classList.add("options-wrapper"),c.append(o,i),t.append(r,c),t},T=function(){return window.location.pathname.split("/")[1]||""},y=function(e){var n=e.userId,a=e.isMuteAudio,t=e.isMuteVideo,r=document.querySelector("#".concat(n," .fa-microphone-slash")),o=document.querySelector("#".concat(n," .fa-video-slash")),i=a?"add":"remove",c=t?"add":"remove";r&&r.classList[i]("red"),o&&o.classList[c]("red")},V=(a(128),"id_".concat(Date.now(),"_").concat(Object(w.a)())),x=function(e){Object(m.a)(a,e);var n=Object(S.a)(a);function a(e){var t;return Object(u.a)(this,a),(t=n.call(this,e)).embadeItemToPartisipantsSection=function(e){return t.partisipantsNode.append(e)},t.embadeItemToScreenShareSection=function(e){return t.shareScreenNode.append(e)},t.openMediaDevices=Object(l.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.localStream){e.next=2;break}return e.abrupt("return",t.localStream);case 2:return e.next=4,navigator.mediaDevices.getUserMedia(D.userConstraints);case 4:return t.localStream=e.sent,n=j(t.localStream,V,!0),t.embadeItemToPartisipantsSection(n),e.abrupt("return",t.localStream);case 8:case"end":return e.stop()}}),e)}))),t.addNewStreamVideo=function(e,n){if(!t.remoteStreams[n]){t.remoteStreams[n]=e;var a=j(e,n);t.embadeItemToPartisipantsSection(a)}},t.addScreenStreamVideo=function(e){if(!t.remotScreenShareStream){t.remotScreenShareStream=e;var n=function(e){var n=document.createElement("video");return n.addEventListener("loadedmetadata",(function(){n.play()})),n.srcObject=e,n.muted=!0,n}(e);t.embadeItemToScreenShareSection(n)}},t.addEventsToRegularCall=function(e){t.regularCalls[e.peer]=e,e.on("stream",(function(n){t.addNewStreamVideo(n,e.peer),t.shareWithMuteSettings()})),e.on("close",(function(){var n=document.getElementById(e.peer);n&&n.remove(),delete t.regularCalls[e.peer],delete t.remoteStreams[e.peer]}))},t.addEventsToIncomingScreenShareCall=function(e){t.screenShareCalls[e.peer]=e,e.on("stream",(function(e){t.addScreenStreamVideo(e)})),e.on("close",(function(){t.shareScreenNode.innerHTML="",t.remotScreenShareStream=null,delete t.screenShareCalls[e.peer]}))},t.makeRegularCall=function(){var e=Object(l.a)(s.a.mark((function e(n){var a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.openMediaDevices();case 2:a=e.sent,r=t.peer.call(n,a),t.addEventsToRegularCall(r);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),t.makeScreenShareCall=function(e){if(t.localScreenShareStream&&!t.screenShareCalls[e]){var n=t.peer.call(e,t.localScreenShareStream,{metadata:{screenSharing:!0}});t.screenShareCalls[n.peer]=n,n.on("close",(function(){delete t.screenShareCalls[n.peer]}))}},t.socketHandler=function(){var e=p()(D.socketUrl);t.socket=e,e.on("connect",(function(){e.on("user-connected",(function(e){t.makeRegularCall(e),t.makeScreenShareCall(e)})),e.on("user-disconnected",(function(e){var n=t.regularCalls[e],a=t.screenShareCalls[e];n&&n.close(),a&&a.close()})),e.on("user-mute",(function(e){y(e)})),e.on("stop-sharing",(function(e){var n=t.screenShareCalls[e];n&&n.close()}))}))},t.peerHandler=function(){t.peer.on("call",function(){var e=Object(l.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g()(n,"metadata.screenSharing")?(n.answer(),t.addEventsToIncomingScreenShareCall(n)):(n.answer(t.localStream),t.addEventsToRegularCall(n));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())},t.onDropCall=function(){t.socket.emit("leave-room");var e=new URL(window.location.origin);window.history.pushState({},"",e),t.localStream.getTracks().forEach((function(e){return e.stop()})),t.localScreenShareStream&&t.localScreenShareStream.getTracks().forEach((function(e){return e.stop()})),t.partisipantsNode.innerHTML="",t.shareScreenNode.innerHTML="",t.remoteStreams={},t.regularCalls={},t.screenShareCalls={},t.localStream=null,t.remotScreenShareStream=null,t.localScreenShareStream=null,t.setState({isJoined:!1,isMuteAudio:!1,isMuteVideo:!1,isSharingScreen:!1})},t.shareWithMuteSettings=function(){var e={isMuteVideo:t.state.isMuteVideo,isMuteAudio:t.state.isMuteAudio,userId:V};t.socket.emit("mute",e)},t.handleMuteChanges=function(){var e=t.state,n=e.isMuteVideo,a=e.isMuteAudio,r={isMuteVideo:n,isMuteAudio:a,userId:V};t.localStream.getTracks().forEach((function(e){"audio"===e.kind&&(e.enabled=!a),"video"===e.kind&&(e.enabled=!n)})),y(r),t.shareWithMuteSettings()},t.onMuteAudio=function(){t.setState({isMuteAudio:!t.state.isMuteAudio},t.handleMuteChanges)},t.onMuteVideo=function(){t.setState({isMuteVideo:!t.state.isMuteVideo},t.handleMuteChanges)},t.stopScreenSharing=function(){Object.values(t.screenShareCalls).forEach((function(e){return e.close()})),t.screenShareCalls={},t.localScreenShareStream=null,t.socket.emit("stop-sharing"),t.setState({isSharingScreen:!1})},t.onShareScreen=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.isSharingScreen){e.next=3;break}return e.abrupt("return");case 3:if(!t.remotScreenShareStream){e.next=6;break}return alert("Other user is sharing"),e.abrupt("return");case 6:return e.prev=6,e.next=9,navigator.mediaDevices.getDisplayMedia(D.screenConstraints);case 9:t.localScreenShareStream=e.sent,t.localScreenShareStream.getVideoTracks()[0].onended=t.stopScreenSharing,t.setState({isSharingScreen:!0}),Object.keys(t.regularCalls).forEach((function(e){return t.makeScreenShareCall(e)})),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("Error: "+e.t0);case 18:case"end":return e.stop()}}),e,null,[[6,15]])}))),t.onKeyDown=function(e){13===e.keyCode&&t.onJoinClick()},t.onChange=function(e){t.setState({roomID:e.target.value.trim()})},t.onJoinClick=Object(l.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=new URL(window.location.origin)).pathname=t.state.roomID,window.history.pushState({},"",n),t.joinRoom();case 4:case"end":return e.stop()}}),e)}))),t.joinRoom=Object(l.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=T(),!t.socket||!n){e.next=6;break}return t.setState({isJoined:!0}),e.next=5,t.openMediaDevices();case 5:t.socket.emit("join-room",n,V);case 6:case"end":return e.stop()}}),e)}))),t.partisipantsNode=null,t.shareScreenNode=null,t.localStream=null,t.remotScreenShareStream=null,t.localScreenShareStream=null,t.screenShareCalls={},t.regularCalls={},t.remoteStreams={},t.state={roomID:T(),isJoined:!1,isMuteAudio:!1,isMuteVideo:!1,isSharingScreen:!1},t}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.peer=new k.a(V),this.socketHandler(),this.peerHandler(),this.joinRoom()}},{key:"render",value:function(){var e=this,n=this.state,a=n.isJoined,t=n.roomID,o=n.isMuteAudio,i=n.isMuteVideo,c=n.isSharingScreen;return r.a.createElement("div",{className:"app"},r.a.createElement("div",{className:"join-block"},r.a.createElement("input",{className:"join-room-input",value:t,onChange:this.onChange,onKeyDown:this.onKeyDown}),r.a.createElement("div",{onClick:this.onJoinClick,className:v()("join-room-btn",{disabled:!t})},r.a.createElement(M.a,{icon:b.d}))),r.a.createElement(O,{isJoined:a,isMuteAudio:o,isMuteVideo:i,isSharingScreen:c,onMuteAudio:this.onMuteAudio,onMuteVideo:this.onMuteVideo,onShareScreen:this.onShareScreen,onDropCall:this.onDropCall,partisipantsRef:function(n){return e.partisipantsNode=n},shareScreenRef:function(n){return e.shareScreenNode=n}}))}}]),a}(r.a.PureComponent);a(129);var A=function(){return r.a.createElement(x,null)};i.a.render(r.a.createElement(A,null),document.getElementById("root"))},52:function(e,n,a){e.exports=a(130)},78:function(e,n){}},[[52,1,2]]]);